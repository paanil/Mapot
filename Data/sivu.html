
<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>UNdataMap</title>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="/static/three.js"></script>
        <script src="/static/stats.min.js"></script>
        <script src="/static/map3d.js"></script>
        <script>window.jQuery || document.write('<script src="/static/jquery.js">\x3C/script>')</script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="static/style.css">
        <script src="static/spectrum.js"></script>
        <link rel="stylesheet" href="static/spectrum.css">
    </head>
    <body>
        
<div>
    <div class="row">
        <div class="col-md-1">Color:</div>
        <div class="col-md-1">
            <div class ="btn-group"><a id="color" class="btn btn-default dropdown-toggle btn-color" data-toggle="dropdown" href="#">Select dataset <span class="caret"></span></a>
                <ul class="dropdown-menu color-dropdown">
                    
                    <li><a href="#" data-value="None">None</a></li>
                    
                    <li><a href="#" data-value="73c227ebfb89cc3f625283630361420f">Population undernourished</a></li>
                    
                    <li><a href="#" data-value="f657be8208d1cb4f06baa770bd91a3ab">Internet users</a></li>
                    
                    <li><a href="#" data-value="a2c2bd985ce4138291bc656b03108c24">Mortality</a></li>
                    
                    <li><a href="#" data-value="196e179a009f64ac70db888b2f3cd18b">Crude birth rate</a></li>
                    
                    <li><a href="#" data-value="edbec26f885cd7843cf45d871ee7db7c">Greenhouse gas</a></li>
                    
                    <li><a href="#" data-value="edc0f73b200e21fad7c541e3f37bda1d">Crude death rate</a></li>
                    
                    <li><a href="#" data-value="4e14f71c5702f5f71ad7de50587e2409">Methane</a></li>
                    
                    <li><a href="#" data-value="6097f89e3092d4ccd249c9d479785c1f">Death</a></li>
                    
                    <li><a href="#" data-value="ac12ee4aedb176eb73ce3f6c0d1e9036">Forest</a></li>
                    
                    <li><a href="#" data-value="b08301af4b631524abd9b9c7d46b4411">People under povertyline</a></li>
                    
                </ul>
            </div>
        </div>
        <div class="col-md-1">
            <div class ="btn-group"><a id="color_parameters" class="btn btn-default dropdown-toggle btn-select2" data-toggle="dropdown" href="#">Parameters<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="#">Divided by population</a></li>
                    <li><a href="#">Divided by area</a></li>
                </ul>
            </div>
        </div>
        <div class="col-md-1">Min color</div>
        <div class="col-md-1">Max color</div>
        <div class="col-md-1">Max height</div>
    </div>
    <div class="row">
        <div class="col-md-1">Height:</div>
        <div class="col-md-1">
            <div class ="btn-group"><a class="btn btn-default dropdown-toggle btn-height" data-toggle="dropdown" href="#">Select dataset <span class="caret"></span></a>
                <ul class="dropdown-menu height-dropdown">
                    
                    <li><a href="#" data-value="None">None</a></li>
                    
                    <li><a href="#" data-value="73c227ebfb89cc3f625283630361420f">Population undernourished</a></li>
                    
                    <li><a href="#" data-value="f657be8208d1cb4f06baa770bd91a3ab">Internet users</a></li>
                    
                    <li><a href="#" data-value="a2c2bd985ce4138291bc656b03108c24">Mortality</a></li>
                    
                    <li><a href="#" data-value="196e179a009f64ac70db888b2f3cd18b">Crude birth rate</a></li>
                    
                    <li><a href="#" data-value="edbec26f885cd7843cf45d871ee7db7c">Greenhouse gas</a></li>
                    
                    <li><a href="#" data-value="edc0f73b200e21fad7c541e3f37bda1d">Crude death rate</a></li>
                    
                    <li><a href="#" data-value="4e14f71c5702f5f71ad7de50587e2409">Methane</a></li>
                    
                    <li><a href="#" data-value="6097f89e3092d4ccd249c9d479785c1f">Death</a></li>
                    
                    <li><a href="#" data-value="ac12ee4aedb176eb73ce3f6c0d1e9036">Forest</a></li>
                    
                    <li><a href="#" data-value="b08301af4b631524abd9b9c7d46b4411">People under povertyline</a></li>
                    
                </ul>
            </div>
        </div>
        <div class="col-md-1">
            <div class ="btn-group"><a class="btn btn-default dropdown-toggle btn-select4" data-toggle="dropdown" href="#">Parameters<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="#">Divided by population</a></li>
                    <li><a href="#">Divided by area</a></li>
                </ul>
            </div>
        </div>
        <div class="col-md-1">
            <input type='text' id="minColor"/>
        </div>
        <div class="col-md-1">
            <input type='text' id="maxColor"/>
        </div>
        <div class="col-md-1">
            <input type="range" name="points" min="0" max="10">
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div id="mapdiv"></div>
        </div>
    </div>
</div>


<script type="text/javascript">
var map;
var color_selection;
var height_selection;
$(document).ready(function () {
    var container = document.getElementById('mapdiv');
    map = new Map3D(container);
    map.setDefaultHeight(0.01);
    map.setHeightRange(0.05, 1.0);
    map.setDefaultColor(0x222222);
    map.setColorRange(0x666666, 0x008800);

    $.getJSON('/_map_data', {},
        function (data) {
            //console.log(data);
            map.setMapData(data);
            //map.setCountry('FIN', 1.0, 1.0);

            //map2.setMapData(data);
        });
});


var colors_changed = function(color) {
var color_min = parseInt($('#minColor').spectrum("get").toHex(), 16);
var color_max = parseInt($('#maxColor').spectrum("get").toHex(), 16);
map.setColorRange(color_min, color_max);
}

$(".color-dropdown li a").click(function(){
  var selText = $(this).text();
  $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
  color_selection = $(this).attr('data-value');
  console.log(color_selection);
  send_query();
});

$(".height-dropdown li a").click(function(){
  var selText = $(this).text();
  $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
  height_selection = $(this).attr('data-value');
  console.log(height_selection);
  send_query();
});

$(function() {
  $('.btn-color').text().onchange = send_query();
  $('.btn-height').text().onchange = send_query();
});

var send_query = function() {

  $.getJSON("/_data", {
        color: color_selection,
        height: height_selection
    },
    function(data) {
        console.log(data);
        map.setData(data);

        /*var normalized_data = normalize_data(data)
        console.log(normalized_data);

        $("#data").text(data);*/
    });
  return false;
};

function normalize_data(data) {
    var normalized_data = {};
    var max_value;
    var min_value;
    for(key in data){
        if(data.hasOwnProperty(key)){
            if(typeof max_value !== "undefined"){
                if(data[key] > max_value) max_value = data[key];
                if(data[key] < min_value) min_value = data[key];
            }
            else{
                max_value = data[key];
                min_value = data[key];
            }
        }
    }

    for(key in data){
        normalized_data[key] = ((data[key])-min_value)/(max_value-min_value);
    }
    return normalized_data;
}

var minColorPalette = {
    showPaletteOnly: true,
    togglePaletteOnly: true,
    togglePaletteMoreText: 'more',
    togglePaletteLessText: 'less',
    color: "#ff0",
    change: colors_changed,
    palette: [
        ["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],
        ["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],
        ["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],
        ["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],
        ["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],
        ["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],
        ["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]
    ]
}

$("#minColor").spectrum(
    minColorPalette
);

maxColorPalette = minColorPalette;
maxColorPalette.color = "#f00";

$("#maxColor").spectrum(
    maxColorPalette
);

</script>

    </body>
</html>
